(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[2],{1929:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),i=p(a),s=(p(n(4)),p(n(1932))),c=(p(n(22)),p(n(13))),l=p(n(1)),d=n(1934),u=n(1935),f=n(42);function p(e){return e&&e.__esModule?e:{default:e}}function h(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}n(1933);s.default.track(!1);var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={json:{},inlt:null,data:{nodes:[],edges:[]},selectedId:(0,d.generateInitSelected)(n.props.list||[]),originalSelectedId:(0,d.generateInitSelected)(n.props.list||[]),researchedata:n.props.researchedata},n.dagre=null,n.graph=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.researchedata;(0,f.getMultiLang)({moduleId:"containers_flowchart",callback:function(n,r,o){r?e.setState({json:n,inlt:o,data:{nodes:d.flowFormatNode.call(e,e.props.list||[],n,t),edges:(0,d.createEdges)(e.props.list||[])}},(function(){e.initFlowChart(),e.expelSelectedId(),e.renderFlowChart(e.state.data,{initCenterPos:!0,shouldChangePos:!0})})):console.log("未加载 containers_flowchart.json 多语文件")}})}},{key:"componentWillReceiveProps",value:function(e){e.list&&!(0,d.equalArray)(e.list,this.props.list)&&this.renderFlowInitData(e.list,e.researchedata),JSON.stringify(e.researchedata)!==JSON.stringify(this.props.researchedata)&&this.renderFlowInitData(e.list,e.researchedata),e.resetChart&&e.resetChart!=this.props.resetChart&&this.renderFlowChart(this.state.data,{initCenterPos:!0,shouldChangePos:!0})}},{key:"renderFlowInitData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={nodes:d.flowFormatNode.call(this,e,this.state.json,n),edges:(0,d.createEdges)(e)},o="";this.state.selectedId||(o=(0,d.generateInitSelected)(e)),this.setState({data:r,selectedId:o,researchedata:n},(function(){t.renderFlowChart(t.state.data)}))}},{key:"expelSelectedId",value:function(){this.props.getSelectId&&r(this.props.getSelectId)&&this.props.getSelectId(this.state.selectedId,this.state.originalSelectedId)}},{key:"initFlowChart",value:function(){(0,u.renderShape)(s.default,"react"),this.graph=new s.default.Graph({container:"mountNode",height:205,fitView:"cc",plugins:[new s.default.Plugins["tool.tooltip"]({getTooltip:function(e){var t=e.item;if(t.isEdge)return t.getModel().desc}}),new s.default.Plugins["tool.minimap"]({container:"mountNode",width:180,height:120})],defaultIntersectBox:"rect",modes:{default:["panBlank","panNode","wheelZoom"]}}),this.graph.edge({style:{endArrow:!0}});this.graph.node({shape:"rect"}),this.itemClickEvent()}},{key:"renderFlowChart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.graph.read(e),t.hasOwnProperty("initCenterPos")&&(this.state.selectedId?this.graph.focus(this.state.selectedId):this.graph.focus("isstart")),t.hasOwnProperty("shouldChangePos"),t.hasOwnProperty("scale")&&(this.graph.zoom(t.scale),t.hasOwnProperty("currId")&&this.graph.focus(t.currId)),this.props.resetChartSuccess&&"function"==typeof this.props.resetChartSuccess&&this.props.resetChartSuccess(!1)}},{key:"itemClickEvent",value:function(){var e=this,t=-1,n=!1;this.graph.on("contextmenu",(function(t){window.event.preventDefault(),e.props.onMenuNode&&"function"==typeof e.props.onMenuNode&&(e.props.onMenuNode(t.item),n=!0)})),this.graph.on("click",(function(r){r.item&&r.item.isNode&&(e.props.onClickNode&&"function"==typeof e.props.onClickNode&&e.props.onClickNode(r.item),setTimeout((function(){if(n)n=!1;else if(!e.props.readOnly&&"isstart"!=r.item.model.id&&"isend"!=r.item.model.id)if(r.item.model.hasOwnProperty("isCurrentNode")&&(t=r.item.model.index),r.item.model.ispassroute){if(r.item.model.index>t&&-1!=t&&(0,c.default)({color:"warning",content:"待张寒定"}),r.item.isNode){var o=r.item.id;o!==e.state.selectedId&&e.setState({selectedId:o},(function(){e.expelSelectedId()}));var a=e.changeNodeColor(e.state.data,e.state.selectedId),i=e.graph.getZoom();e.setState({data:a},(function(){e.renderFlowChart(a,{scale:i,currId:r.item.model.id})}))}}else(0,c.default)({color:"warning",content:e.state.json["005"]})}),100))}))}},{key:"changeNodeColor",value:function(e,t){[].concat(h(e.nodes),h(e.edges)).map((function(e,t){e.color=null}));var n=e.nodes;e.edges;if(n)return n.forEach((function(e,n){e&&(e.id===t?(e.color="#FFBCCA",e.style.stroke="#FF7B96"):e.ispassroute?e.ispassroute&&(e.color="#399FFE",e.style.stroke="#A8D5FF"):(e.color="#E0E0E0",e.style.stroke="#D5D4D5"))})),e}},{key:"render",value:function(){return i.default.createElement("div",{className:"flow-chart-contain"},i.default.createElement("div",{id:"mountNode",className:"dagre"}))}}]),t}(a.Component);g.propTypes={readOnly:l.default.boolean},g.defaultProps={readOnly:!1},t.default=g},1934:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equalArray=t.generateInitSelected=t.dragNodeChangePostion=t.createEdges=t.flowFormatNode=void 0;var r,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(60),i=(r=a)&&r.__esModule?r:{default:r};var s=function(e){if(!e.length)return[];var t={},n=[],r=e.filter((function(e,r){return e.startnode?(t=o({},e),r):e.isendnode&&(n.push(e),r),!e.startnode&&!e.isendnode}));return Object.keys(t).length&&r.unshift(t),n.length&&(r=r.concat(n)),r},c=function(e){var t=s(e);if(!t.length)return[];var n=-1,r=-1,o=!0,a="",i=t.filter((function(e,t){return e.ispassroute||!o||e.startnode||e.isendnode?!e.ispassroute||e.startnode||e.isendnode||(n=t):(o=!1,r=t),e.ispassroute&&!e.startnode&&!e.isendnode})),c=t.find((function(e,t){return!e.ispassroute&&!e.startnode&&!e.isendnode})),l=t.find((function(e,t){return e.hasOwnProperty("isCurrentNode")&&e.isCurrentNode&&(a=t+","),e.isCurrentNode})),d=t.find((function(e,t){return e.isfinished}));return(!d||!Object.keys(d).length)&&(l&&Object.values(l)?a.substring(0,a.length-1):!c&&Object.keys(i).length?t.length-2:!(!i.length||0==r)&&(n>r?n:r-1))};function l(e,t,n){var r="#DFDEDF";return t===n||e.isCurrentNode?r="#FF96AC":e.ispassroute?r="#0092FE":e.isforecast&&(r="#FFC285"),r}var d=function(e,t){console.log("obj",t.act_name,t);var n="#E0E0E0";return e.ispassroute?n="#A8D5FF":e.isforecast&&(t.isforecast||t.ispassroute)&&(n="#FFD9B3"),n};t.flowFormatNode=function(e,t,n){console.log("researchedata",n);var r=s(e);if(!r.length)return[];var o=c(r);return console.log("initSelectedIndex",o),r.map((function(e,r){var a=e.act_name&&e.act_name.length>7?e.act_name.slice(0,7)+"...":e.act_name,i="#E0E0E0";return r===o||e.isCurrentNode?i="#FFBCCA":e.ispassroute?i="#A8D5FF":(e.isforecast||n&&Object.keys(n).length&&Object.keys(n).includes(e.act_id))&&(i="#FFD9B3"),{id:e.act_id?e.act_id:e.startnode?"isstart":"isend"+r,name:a||(e.startnode?t["006"]:t["007"]),x:e.dimension.split(";")[0],y:e.dimension.split(";")[1],color:i,ispassroute:e.ispassroute,style:{stroke:l(e,r,o)},label:{text:a||(e.startnode?t["006"]:t["007"]),fontSize:13},tipName:e.act_name?e.act_name:e.startnode?t["006"]:t["007"],billmaker:e.billmaker,actType:e.act_type_value||t["009"],merge_way:e.merge_way||t["009"],branch_way:e.branch_way||t["009"],ismain:e.ismain||!1,isstart:e.isstart||!1,index:r,racemodal:e.racemodal,participantProcessModeValue:e.participantProcessModeValue,participantProcessPassingThreshold:e.participantProcessPassingThreshold,actortype:e.actortype,actor:e.actor,approveusers:e.approveusers||[],transitionName:e.transitionName||"",transitionDesc:e.transitionDesc||"",isforecast:e.isforecast||!1,branch_way_value:e.branch_way_value||"",merge_way_value:e.merge_way_value||"",act_type:e.act_type||"",committime:e.committime||""}}))},t.createEdges=function(e){var t=s(e);if(!t.length)return[];var n=[];return t.map((function(e,r){if(r>0){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e?e.includes(t)?e.split(t):e:"isstart"}(e.from_id);if(o instanceof Array)o.map((function(r){var o=t.find((function(e){return e.act_id===r}));n.push({source:r,target:e.act_id,id:r+"-"+e.act_id,color:d(e,o),label:e.transitionName,desc:e.transitionDesc})}));else{var a=-1,s=null,c=(0,i.default)(t);s=(s=c.find((function(t,n){if(e.from_id&&e.isforecast&&e.from_id.includes(t.act_id))return a=n,!0})))||{},console.log("obj111",s.act_name,s),a>-1&&c.splice(a,1);var l=e.from_id||"isstart",u=e.act_id||"isend"+r;n.push({source:l,target:u,id:l+"-"+u,color:d(e,s),label:e.transitionName,desc:e.transitionDesc})}}})),n},t.dragNodeChangePostion=function(e){var t=void 0,n=void 0,r=void 0;e.on("node:dragstart",(function(e){var o=e.item,a=o.getModel();t=o,n=a.x-e.x,r=a.y-e.y})),e.on("node:drag",(function(o){t&&e.update(t,{x:o.x+n,y:o.y+r})})),e.on("node:dragend",(function(e){t=void 0}))},t.generateInitSelected=function(e){var t=s(e),n=c(t);return n&&t.length?t.find((function(e,t){return n.toString().includes(",")?n.toString().includes(t):n==t})).act_id:""},t.equalArray=function(e,t){return!t||"Array"===Object.prototype.toString.call(e).slice(8,-1)&&"Array"===Object.prototype.toString.call(t).slice(8,-1)&&JSON.stringify(e)===JSON.stringify(t)}},1935:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.renderShape=function(e,t){if("react"===t)return e.registerNode("rect",{getPath:function(t){return e.Util.getRectPath(-50,-15,100,30,15)}})}}}]);
//# sourceMappingURL=FlowChart.js.map