(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[1],{1930:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(0),a=s(o),i=r(10),l=s(r(13)),c=r(1936);function s(t){return t&&t.__esModule?t:{default:t}}function u(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}r(1937);var p=r(1932),d=r(1933);p.track(!1);var f=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.getDrawDagreData=function(t){var e={nodes:t,edges:[]};t.forEach((function(t){var r;return(r=e.edges).push.apply(r,u((0,c.createEdges)(t)))})),r.setState({data:e,extract:!1},(function(){r.renderDagre(r.changeColor(r.state.data))}))},r.renderShape=function(t,e){if("react"===e)return t.registerNode("rect",{getPath:function(){return t.Util.getRectPath(-68,-25,136,50,10)}})},r.initDagre=function(){var t=r.props.tooltipText;r.renderShape(p,"react"),r.dagre=new d["layout.dagre"]({rankdir:"LR",nodesep:30,ranksep:30}),r.tooltip=new p.Plugins["tool.tooltip"]({getTooltip:function(e){var r=e.item.getModel();if(r){var n=r.billTypeName,o=r.billCode;return'<ul class="dagre-toolTip">\n\t\t\t\t\t\t\t\t<li class="dagre-toolTip-title">'+(t&&t[0]?t[0]:"单据名称-1")+": "+n+'</li>\n\t\t\t\t\t\t\t\t<li class="dagre-toolTip-billcode">'+(t&&t[1]?t[1]:"单据编号-1")+": "+o+"</li>\n\t\t\t\t\t\t\t</ul>"}}}),r.graph=new p.Graph({id:"mountNode",heigth:250,plugins:[r.dagre,r.tooltip],defaultIntersectBox:"rect",modes:{default:["panBlank","panNode","wheelZoom"]}}),r.graph.edge({style:{endArrow:!0},label:function(t){return t.shape},size:1}),r.graph.node({shape:"rect",style:{stroke:"#CCEAFF"}}),r.itemClickEvent(),r.graph.on("wheel",(function(){var t=r.graph.getZoom();r.setState({wheelScrollZoom:t})}))},r.calculaterGraphPosition=function(t){var e=r.graph,n=[],o=0,a=0;if(t.nodes.length>1){if(t.nodes.forEach((function(t){t.source.length&&n.push(t.source),t.target.length&&n.push(t.target)})),n.length){o=n.length+1;var i=[];n.forEach((function(t){i.push(t.length)})),i.sort((function(t,e){return e-t}));var l=136*o+30*(o-1),c=50*(a=i[0])+30*(a-1),s=document.querySelector(".dagreScrollWrap");if(s&&r.firstRender){var u=s.clientHeight,p=s.clientWidth;r.dagreScrollWrapHeight=u,r.dagreScrollWrapWidth=p;var d=(u-c)/2,f=(p-l)/2;r.dagreScrollWrapHeight&&(f>=0&&d>=0?e.translate(f,d):f>=0&&d<=0?e.translate(f,0):d>=0&&f<=0&&e.translate(0,d),r.setState({graphWidth:l,graphHeight:c}),r.firstChangeZoom=!0,r.firstRender=!1)}}}else if(1===t.nodes.length){var g=document.querySelector(".dagreScrollWrap");if(g&&r.firstRender){var h=g.clientHeight,y=g.clientWidth;r.dagreScrollWrapHeight=h,r.dagreScrollWrapWidth=y;var v=(h-50)/2,m=(y-136)/2;e.translate(m,v),r.setState({graphWidth:136,graphHeight:50}),r.firstRender=!1,r.firstChangeZoom=!0}}},r.renderDagre=function(t){r.calculaterGraphPosition(t);var e=r.graph;(0,c.dragNodeChangePostion)(e),e.read(t),e&&r.currentZoom&&e.zoom(r.currentZoom)},r.itemClickEvent=function(){r.graph.on("click",(function(t){if(t.item&&t.item.isNode){var e=t.item.id;if(e!==r.state.selectedId)if(r.setState({selectedId:e},(function(){r.props.getSelectId&&r.props.getSelectId(e)})),r.state.extract){var n=r.changeColor(r.state.relatedData);r.setState({relatedData:n},(function(){return r.renderDagre(n)}))}else{var o=r.changeColor(r.state.data);r.setState({data:o},(function(){return r.renderDagre(o)}))}}})),r.graph.on("dblclick",(function(t){if(t.item&&"node"===t.item.type){var e=t.item.model.id,n=r.state.data.nodes.find((function(t){return t.id==e})).type,o=r.state.data.nodes.find((function(t){return t.id==e})).transtype;r.props.onSelect&&r.props.onSelect(e,n,o)}}))},r.changeColor=function(t){r.currentZoom=r.graph.getZoom(),t.nodes.forEach((function(t){t&&t.color&&(t.color="#fff")})),t.edges.forEach((function(t){t&&t.color&&(t.color="#888")}));var e=r.state,n=e.selectedId,o=e.extract,a=e.relatedData;if(n){var i=(0,c.getRelated)(n,r.state.data),l=o?(0,c.getRelated)(n,a):{nodes:[],edges:[]},s=[].concat(u(i.nodes),u(l.nodes)),p=[].concat(u(i.edges),u(l.edges));s&&(s.forEach((function(t){t&&(t.id===r.state.selectedId?(t.label&&t.label.fill&&(t.label.fill="#007ACE"),t.color="#CCEAFF"):(t.label&&t.label.fill&&(t.label.fill="#F87321"),t.color="#FFE19D"))})),p.forEach((function(t){t&&t.color&&(t.color="green")})))}return t},r.handleClick=function(){var t=r.props.extractTip;r.state.extract?(r.setState({extract:!r.state.extract}),r.renderDagre(r.state.data)):r.state.selectedId?r.setState({extract:!r.state.extract,relatedData:(0,c.getRelated)(r.state.selectedId,r.state.data)},(function(){var t=r.changeColor(r.state.relatedData);r.renderDagre(t)})):(0,l.default)({color:"warning",content:t})},r.calculatePostionbBeforeRender=function(t){var e=r.state,n=e.graphHeight,o=e.graphWidth,a=e.wheelScrollZoom;setTimeout((function(){var e=document.querySelector(".dagreScrollWrap");if(e){var i=e.clientHeight,l=e.clientWidth;if(i-n>=0)if(r.dagreScrollH){if(n&&!1===t&&!r.hasTableDy){var c=(i-n)/2,s=c-(i-n)/2;r.hasTableDy=c,r.graph.translate(0,s),r.prevDy=s}}else r.dagreScrollH=i;else if(i-n<0&&i&&(r.dagreScrollH=n,r.firstChangeZoom)){r.firstChangeZoom=!1;var u=l/o,p=i/n;r.currentZoom=u<p?u:p,a?r.graph.zoom(a):r.graph.zoom(r.currentZoom)}l-o>=0?r.dagreScrollW||(r.dagreScrollW=l):r.dagreScrollW||(r.dagreScrollH=o)}}),50)},r.state={data:{nodes:r.props.list,edges:(0,c.createEdges)(r.props.list)},selectedId:r.props.selectedId||"",extract:!1,relatedData:null,graphHeight:0,graphWidth:0,wheelScrollZoom:null},r.dagre=null,r.tooltip=null,r.graph=null,r.currentZoom=null,r.firstRender=!0,r.dagreScrollH=null,r.dagreScrollW=null,r.dagreScrollWrapHeight=0,r.dagreScrollWrapWidth=0,r.firstChangeZoom=!1,r.hasTableDy=null,r.prevDy=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentWillMount",value:function(){var t=this.props,e=t.list;"BillTrack"!==t.parentCom&&this.getDrawDagreData(e)}},{key:"componentDidMount",value:function(){var t=this.props.getSelectId;this.initDagre(),t&&"function"==typeof t&&t(this.state.selectedId)}},{key:"componentWillReceiveProps",value:function(t){var e=t.list,r=t.size;this.getDrawDagreData(e),void 0!==r&&r!==this.props.size&&(1==r?this.graph.translate(0,-this.prevDy):this.graph.translate(0,this.prevDy))}},{key:"render",value:function(){var t=this.props,e=t.size,r=t.extractBtns,n=void 0;return r&&(n=this.state.extract?r[0]:r[1]),this.calculatePostionbBeforeRender(e),a.default.createElement("div",{className:(this.props.className?this.props.className:"")+" dagre-area ",style:{height:e?"96%":"50%"}},n&&a.default.createElement(i.NCButton,{className:"button-primary dagre-extract",fieldid:this.state.extract?"show-all":"dagre-extract",onClick:this.handleClick},n),a.default.createElement("div",{className:"dagreScrollWrap"},a.default.createElement("div",{className:"dagreScroll",style:{height:"100%",width:"100%"}},a.default.createElement("div",{id:"mountNode",className:"dagre",style:{width:"100%"}}))))}}]),e}(o.Component);e.default=f},1936:function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});e.flowFormatNode=function(t){return t.map((function(t,e){return{id:t.act_id,label:{text:t.label},name:t.act_name}}))},e.createEdges=function(t){switch(t.isForward){case"0":var e=t.source.map((function(e){return{source:e,target:t.id}})),r=t.target.map((function(e){return{source:t.id,target:e}}));return[].concat(n(e),n(r));case"1":return t.target.map((function(e){return{source:t.id,target:e}}));case"-1":return t.source.map((function(e){return{source:e,target:t.id}}));default:return[]}},e.dragNodeChangePostion=function(t){var e=void 0,r=void 0,n=void 0;t.on("node:dragstart",(function(t){var o=t.item,a=o.getModel();e=o,r=a.x-t.x,n=a.y-t.y})),t.on("node:drag",(function(o){e&&t.update(e,{x:o.x+r,y:o.y+n})})),t.on("node:dragend",(function(t){e=void 0}))},e.generateInitSelected=function(t){return t.filter((function(t,e){return t.ispassroute}))},e.equalArray=function(t,e){return!(!t||!e)&&("Array"===Object.prototype.toString.call(t).slice(8,-1)&&"Array"===Object.prototype.toString.call(e).slice(8,-1)&&JSON.stringify(t)===JSON.stringify(e))},e.getRelated=function(t,e){var r=[],o=[],a=[];!function t(a){var i,l=e.edges.filter((function(t){return t.target===a})),c=l.map((function(t){return t.source}));(i=r).push.apply(i,n(l)),o.push.apply(o,n(c)),c.length>0&&c.forEach((function(e){return t(e)}))}(t),function t(o){var i,l=e.edges.filter((function(t){return t.source===o})),c=l.map((function(t){return t.target}));(i=r).push.apply(i,n(l)),a.push.apply(a,n(c)),c.length>0&&c.forEach((function(e){return t(e)}))}(t),r=[].concat(n(new Set(r)));var i=[].concat(n(new Set([].concat(o,[t],a)))).map((function(t){return e.nodes.find((function(e){return e.id===t}))}));return{edges:r,nodes:i}}},1937:function(t,e,r){var n;window,t.exports=(n=r(1932),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=133)}({133:function(t,e,r){var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o=r(3),a=o.Util,i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=n({dx:10,dy:10,getTooltip:function(t){var e=t.item;if(e){var r=e.getModel().tooltip;if(r){var n="",o=e.type;return a.isArray(r)?r.forEach((function(t){n+='<li style="font-size: 12px;list-style-type: none;"><span>'+t[0]+"</span>: "+t[1]+"</li>"})):(o=r.title,r.list.forEach((function(t){n+='<li style="font-size: 12px;list-style-type: none;"><span>'+t[0]+"</span>: "+t[1]+"</li>"}))),'\n              <div class="g6-tooltip" style="\n                position: absolute;\n                white-space: nowrap;\n                zIndex: 8;\n                transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);\n                background-color: rgba(255, 255, 255, 0.9);\n                box-shadow: 0px 0px 10px #aeaeae;\n                border-radius: 3px;\n                color: rgb(87, 87, 87);\n                line-height: 20px;\n                padding: 10px 10px 6px 10px;\n              ">\n                <h4 class="g6-tooltip-title" style="\n                  margin: 0;\n                ">'+o+'</h4>\n                <ul class="g6-tooltip-list" style="\n                  padding: 0;\n                  margin: 0;\n                  margin-top: 4px;\n                ">\n                  '+n+"\n                </ul>\n              </div>\n            "}}return null}},e)}return t.prototype.init=function(){var t=this,e=this.graph;e.on("mouseenter",(function(e){e.shape&&t.onMouseEnter(e)})),e.on("mousemove",(function(e){t.onMouseMove(e)})),e.on("mouseleave",(function(e){t.onMouseLeave(e)}))},t.prototype.onMouseEnter=function(t){var e=this.graph.getGraphContainer(),r=this.options.getTooltip(t),n=this.tooltip;n&&this.tooltip.destroy(),r?((n=a.createDOM(r)).css({position:"absolute"}),e.appendChild(n)):n=null,this.tooltip=n},t.prototype.onMouseMove=function(t){var e=t.domX,r=t.domY,n=this.tooltip;if(n){var o=this.graph,i=a.getOuterWidth(n),l=a.getOuterHeight(n),c=o.getWidth(),s=o.getHeight();n.css({top:this._getTop(l,s,r),left:this._getLeft(i,c,e)})}},t.prototype.onMouseLeave=function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)},t.prototype._getTop=function(t,e,r){var n=this.options.dy;return 2*t>=e?"0px":r<t+n?r+n+"px":r-t-n+"px"},t.prototype._getLeft=function(t,e,r){var n=this.options.dx;return 2*t>=e?"0px":e-r-n<t?r-t-n+"px":r+n+"px"},t.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy()},t}();o.Plugins["tool.tooltip"]=i,t.exports=i},3:function(t,e){t.exports=n}}))}}]);
//# sourceMappingURL=DagreChart.js.map