{"version":3,"sources":["webpack://[name]/./src/platform/containers/FlowChart/Component.js","webpack://[name]/./src/platform/containers/FlowChart/method.js","webpack://[name]/./src/platform/containers/FlowChart/NodeRender.js"],"names":["require","G6","track","FlowChart","props","state","json","inlt","data","nodes","edges","selectedId","generateInitSelected","list","originalSelectedId","researchedata","dagre","graph","this","getMultiLang","moduleId","callback","status","setState","flowFormatNode","call","createEdges","initFlowChart","expelSelectedId","renderFlowChart","initCenterPos","shouldChangePos","console","log","nextProps","equalArray","renderFlowInitData","JSON","stringify","resetChart","getSelectId","renderShape","Graph","container","height","fitView","plugins","Plugins","getTooltip","item","isEdge","getModel","desc","width","defaultIntersectBox","modes","default","edge","style","endArrow","node","shape","itemClickEvent","params","read","hasOwnProperty","focus","zoom","scale","currId","resetChartSuccess","isCurrentNodeIndex","isContextMenu","on","ev","window","event","preventDefault","onMenuNode","isNode","onClickNode","setTimeout","readOnly","model","id","index","ispassroute","color","content","changeNodeColor","getZoom","map","forEach","stroke","className","Component","propTypes","PropTypes","boolean","defaultProps","formatBeginEndDataSequence","length","beginNodeObj","endNodeArr","otherData","filter","startnode","isendnode","push","Object","keys","unshift","concat","findInitSelectedIndex","originalData","initPassIndex","initNotPassIndex","isFirstNotPassRoute","isPassArr","isNotPass","find","isCurrentNodeObj","isCurrentNode","finishedObj","isfinished","values","substring","gerStrokeColor","initSelectedIndex","isforecast","gerEdgeColor","obj","act_name","international","virtualName","slice","includes","act_id","name","x","dimension","split","y","label","text","fontSize","tipName","billmaker","actType","act_type_value","merge_way","branch_way","ismain","isstart","racemodal","participantProcessModeValue","participantProcessPassingThreshold","actortype","actor","approveusers","transitionName","transitionDesc","branch_way_value","merge_way_value","act_type","committime","edgesArr","originalFromId","fromId","sign","splitFromIdBySign","from_id","Array","childItem","prevNode","source","target","curIndex","virData","index_0","splice","actId","dragNodeChangePostion","dx","dy","update","undefined","toString","arr1","arr2","prototype","registerNode","getPath","Util","getRectPath"],"mappings":"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","file":"FlowChart.js","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport G6 from '@antv/g6';\nimport ajax from '../../api/ajax';\nimport toast from '../../api/toast';\nimport PropTypes from 'prop-types';\nimport { flowFormatNode, createEdges, dragNodeChangePostion, generateInitSelected, equalArray } from './method';\nimport { renderShape } from './NodeRender';\nimport { getMultiLang } from '../../api/getMultiLang';\n\nconst G6Plugins = require('@antv/g6/build/plugins');\n\n// 关闭 G6 的体验改进计划打点请求\nG6.track(false);\n\nclass FlowChart extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tjson: {},\n\t\t\tinlt: null,\n\t\t\tdata: {\n\t\t\t\tnodes: [],\n\t\t\t\tedges: []\n\t\t\t},\n\t\t\tselectedId: generateInitSelected(this.props.list || []), // 选中的节点id，页面初加载时选中节点为基本节点,即基于基本节点构建的上下游关系\n\t\t\toriginalSelectedId: generateInitSelected(this.props.list || []), //用于判断选中的节点是否是自身\n\t\t\tresearchedata: this.props.researchedata\n\t\t};\n\t\tthis.dagre = null;\n\t\tthis.graph = null;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {researchedata} = this.state;\n\t\tlet callback = (json, status, inlt) => {\n\t\t\tif (status) {\n\t\t\t\tthis.setState(\n\t\t\t\t\t{\n\t\t\t\t\t\tjson,\n\t\t\t\t\t\tinlt,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tnodes: flowFormatNode.call(this, this.props.list || [], json, researchedata),\n\t\t\t\t\t\t\tedges: createEdges(this.props.list || [])\n\t\t\t\t\t\t} // 节点&流程指向数据\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.initFlowChart();\n\t\t\t\t\t\tthis.expelSelectedId();\n\t\t\t\t\t\tthis.renderFlowChart(this.state.data, { initCenterPos: true, shouldChangePos: true });\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconsole.log('未加载 containers_flowchart.json 多语文件');\n\t\t\t}\n\t\t};\n\t\tgetMultiLang({ moduleId: 'containers_flowchart', callback });\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (nextProps.list && !equalArray(nextProps.list, this.props.list)) {\n\t\t\tthis.renderFlowInitData(nextProps.list, nextProps.researchedata);\n\t\t}\n\t\t// console.log(this.props.researchedata, nextProps.researchedata)\n\t\tif(JSON.stringify(nextProps.researchedata) !== JSON.stringify(this.props.researchedata)) {\n\t\t\tthis.renderFlowInitData(nextProps.list, nextProps.researchedata);\n\t\t}\n\n\t\tif (nextProps.resetChart && nextProps.resetChart != this.props.resetChart) {\n\t\t\tthis.renderFlowChart(this.state.data, { initCenterPos: true, shouldChangePos: true });\n\t\t}\n\t}\n\n\t//格式化数据\n\trenderFlowInitData(list, researchedata = {}) {\n\t\tconst data = {\n\t\t\tnodes: flowFormatNode.call(this, list, this.state.json, researchedata),\n\t\t\tedges: createEdges(list)\n\t\t};\n\t\tlet selectedId = '';\n\t\tif (!this.state.selectedId) {\n\t\t\tselectedId = generateInitSelected(list);\n\t\t}\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\tdata,\n\t\t\t\tselectedId,\n\t\t\t\tresearchedata\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tthis.renderFlowChart(this.state.data);\n\t\t\t}\n\t\t);\n\t}\n\n\t// componentDidMount() {\n\t//     this.initFlowChart();\n\t//     this.expelSelectedId();\n\t//     this.renderFlowChart(this.state.data);\n\t// }\n\n\t//节点选中,数据回传\n\texpelSelectedId() {\n\t\tif (this.props.getSelectId && typeof this.props.getSelectId) {\n\t\t\tthis.props.getSelectId(this.state.selectedId, this.state.originalSelectedId);\n\t\t}\n\t}\n\n\t// 初始化渲染并绑定节点事件\n\tinitFlowChart() {\n\t\trenderShape(G6, 'react');\n\t\tthis.graph = new G6.Graph({\n\t\t\tcontainer: 'mountNode',\n\t\t\theight: 205,\n\t\t\tfitView: 'cc',\n\t\t\tplugins: [\n\t\t\t\tnew G6.Plugins['tool.tooltip']({\n\t\t\t\t\tgetTooltip({ item }) {\n\t\t\t\t\t\tif(!item.isEdge) return ;\n\t\t\t\t\t\tconst model = item.getModel();\n\t\t\t\t\t\treturn model.desc;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew G6.Plugins['tool.minimap']({\n\t\t\t\t\tcontainer: 'mountNode',\n\t\t\t\t\twidth: 180,\n\t\t\t\t\theight: 120\n\t\t\t\t})\n\t\t\t],\n\t\t\tdefaultIntersectBox: 'rect', // 使用矩形包围盒\n\t\t\tmodes: {\n\t\t\t\tdefault: [ 'panBlank', 'panNode', 'wheelZoom' ]\n\t\t\t}\n\t\t});\n\n\t\t//流程线条箭头设置\n\t\tthis.graph.edge({\n\t\t\tstyle: {\n\t\t\t\tendArrow: true\n\t\t\t}\n\t\t});\n\n\t\tconst that = this;\n\t\t//流程节点数据提示、形状设置\n\t\tthis.graph.node({\n\t\t\tshape: 'rect'\n\t\t});\n\t\t// if (!that.props.readOnly) {\n\t\t\tthat.itemClickEvent();\n\t\t// }\n\t}\n\n\trenderFlowChart(data, params = {}) {\n\t\t// this.graph.remove()\n\t\tthis.graph.read(data);\n\t\t//初始化中心节点位置\n\t\tif (params.hasOwnProperty('initCenterPos')) {\n\t\t\tif (this.state.selectedId) {\n\t\t\t\tthis.graph.focus(this.state.selectedId);\n\t\t\t} else {\n\t\t\t\tthis.graph.focus('isstart');\n\t\t\t}\n\t\t}\n\t\t//只在初始化调用一次节点位置变更事件(通过panNode模式调用)\n\t\tif (params.hasOwnProperty('shouldChangePos')) {\n\t\t\t// dragNodeChangePostion(this.graph);\n\t\t}\n\t\t//点击后维持原来缩放比\n\t\tif (params.hasOwnProperty('scale')) {\n\t\t\tthis.graph.zoom(params.scale);\n\t\t\tparams.hasOwnProperty('currId') && this.graph.focus(params.currId);\n\t\t}\n\n\t\tif (this.props.resetChartSuccess && typeof this.props.resetChartSuccess == 'function') {\n\t\t\tthis.props.resetChartSuccess(false);\n\t\t}\n\t}\n\n\t//节点点击事件绑定\n\titemClickEvent() {\n\t\tlet isCurrentNodeIndex = -1;\n\t\tlet isContextMenu = false;\n\t\tthis.graph.on('contextmenu', (ev) => {\n\t\t\tconst e = window.event;\n\t\t\te.preventDefault();\n\t\t\tif(this.props.onMenuNode && typeof this.props.onMenuNode === \"function\") {\n\t\t\t\tthis.props.onMenuNode(ev.item);\n\t\t\t\tisContextMenu = true;\n\t\t\t}\n\t\t})\n\n\t\tthis.graph.on('click', (ev) => {\n\t\t\tif (!ev.item || !ev.item.isNode) return;\n\t\t\tif(this.props.onClickNode && typeof this.props.onClickNode === \"function\") {\n\t\t\t\tthis.props.onClickNode(ev.item);\n\t\t\t}\n\t\t\tsetTimeout( () => {\n\t\t\t\tif(isContextMenu) {//右键不允许触发左键关联方法\n\t\t\t\t\tisContextMenu = false;\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\t\t\t\tif (this.props.readOnly) return ;\n\t\t\t\tif (ev.item.model.id == 'isstart' || ev.item.model.id == 'isend') return;\n\t\t\t\t//有一个环节被驳回到之前流程，不能驳回之后的环节\n\t\t\t\tif (ev.item.model.hasOwnProperty('isCurrentNode')) {\n\t\t\t\t\tisCurrentNodeIndex = ev.item.model.index;\n\t\t\t\t}\n\n\t\t\t\t//未过的流程不允许选择\n\t\t\t\tif (!ev.item.model.ispassroute) {\n\t\t\t\t\ttoast({ color: 'warning', content: this.state.json['005'] }); // 005 未通过的环节不能驳回，请重新选择\n\t\t\t\t\treturn;\n\t\t\t\t} else if (ev.item.model.index > isCurrentNodeIndex && isCurrentNodeIndex != -1) {\n\t\t\t\t\ttoast({ color: 'warning', content: '待张寒定' });\n\t\t\t\t}\n\t\t\t\tif (ev.item.isNode) {\n\t\t\t\t\tlet selectedId = ev.item.id;\n\t\t\t\t\tif (selectedId !== this.state.selectedId) {\n\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\tselectedId\n\t\t\t\t\t\t\t},() => {\n\t\t\t\t\t\t\t\tthis.expelSelectedId();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet data = this.changeNodeColor(this.state.data, this.state.selectedId);\n\t\t\t\t\tconst scale = this.graph.getZoom();\n\t\t\t\t\tthis.setState({ data }, () => {\n\t\t\t\t\t\tthis.renderFlowChart(data, { scale, currId: ev.item.model.id });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 100)\n\t\t});\n\t}\n\n\t//改变节点选中颜色\n\tchangeNodeColor(data, selectedId) {\n\t\t[ ...data.nodes, ...data.edges ].map((item, index) => {\n\t\t\titem.color = null;\n\t\t});\n\t\tconst { nodes, edges } = data;\n\t\tif (!nodes) return;\n\t\tnodes.forEach((item, index) => {\n\t\t\tif (item) {\n\t\t\t\tif (item.id === selectedId) {\n\t\t\t\t\titem.color = '#FFBCCA';\n\t\t\t\t\titem.style.stroke = '#FF7B96';\n\t\t\t\t} else if (!item.ispassroute) {\n\t\t\t\t\titem.color = '#E0E0E0';\n\t\t\t\t\titem.style.stroke = '#D5D4D5';\n\t\t\t\t} else if (item.ispassroute) {\n\t\t\t\t\titem.color = '#399FFE';\n\t\t\t\t\titem.style.stroke = '#A8D5FF';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn data;\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"flow-chart-contain\">\n\t\t\t\t<div id=\"mountNode\" className=\"dagre\" />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nFlowChart.propTypes = {\n\treadOnly: PropTypes.boolean //水平子元素对齐方式\n};\n\n//指定默认值:\nFlowChart.defaultProps = {\n\treadOnly: false\n};\n\nexport default FlowChart;\n","/**对后台返回数据二次排序，主要调整开始，结束节点位置\n * startnode开始节点，isendnode结束节点\n * **/\nimport deepClone from \"../../public/deepClone\";\nconst formatBeginEndDataSequence = (data) => {\n    if(!data.length) {return []}\n    let beginNodeObj = {};\n    let endNodeArr = [];//可能有多个结束节点\n    let beginNodeIndex = -1;\n    let endNodeIndex = -1;\n    let otherData = data.filter( (item, index) => {\n        if(item.startnode) {\n            beginNodeObj = {...item};\n            beginNodeIndex = index;\n        }else if(item.isendnode) {\n            endNodeArr.push(item);\n            endNodeIndex = index;\n        }\n        return !item.startnode && !item.isendnode\n    })\n    Object.keys(beginNodeObj).length && otherData.unshift(beginNodeObj);\n\n    if(endNodeArr.length) {\n        otherData = otherData.concat(endNodeArr);\n    }\n\n    return otherData;\n}\n\n\n/**\n * 查找当前正处于的节点\n * isPassroute 的最后一项\n * **/\nconst findInitSelectedIndex = (originalData) => {\n    const data = formatBeginEndDataSequence(originalData);\n    if(!data.length) {return []};\n    let initPassIndex = -1;\n    let initNotPassIndex = -1;\n    let isFirstNotPassRoute = true;\n    let isCurrentNodeIndex = '';//可能有多个\n    const isPassArr = data.filter( (item, index) => {\n        // 找到最后一条pass数据(多分支情况可能有某个分支未通过，但下级分支通过情况)\n        if(!item.ispassroute && isFirstNotPassRoute && !item.startnode && !item.isendnode) {\n            isFirstNotPassRoute = false;\n            initNotPassIndex = index;\n        }else if(item.ispassroute && !item.startnode && !item.isendnode) {\n            initPassIndex = index;\n        }\n        return item.ispassroute && !item.startnode && !item.isendnode\n    })\n    const isNotPass = data.find( (item, index) => {\n        return !item.ispassroute && !item.startnode && !item.isendnode\n    })\n\n    //找寻当前所处节点，如果此节点存在，则此节点为当前选中节点，且后面节点通过，但不可驳回操作\n    const isCurrentNodeObj = data.find( (item, index) => {\n        if(item.hasOwnProperty('isCurrentNode') && item.isCurrentNode) {\n            isCurrentNodeIndex = index + ','; \n        }\n        return item.isCurrentNode;\n    })\n\n    //isfinished表示该节点进去，此节点已经被走过并完成\n    const finishedObj = data.find( (item, index) => {\n        return item.isfinished\n    })\n    \n    if(!!finishedObj && Object.keys(finishedObj).length) {\n        return false;//找不到的节点坐标\n    }else if(isCurrentNodeObj && Object.values(isCurrentNodeObj)) {//有个节点被驳回到当前节点之前节点\n        return isCurrentNodeIndex.substring(0,isCurrentNodeIndex.length-1);\n    }else if(!isNotPass && Object.keys(isPassArr).length) {//全是已走过的流程节点\n        return data.length-2\n    }else if(!isPassArr.length || initNotPassIndex == 0) {//全是未走的流程\n        return false;\n    }\n    \n    return initPassIndex > initNotPassIndex ? initPassIndex : initNotPassIndex-1;\n}\n\nfunction gerStrokeColor(item, index, initSelectedIndex) {\n    let color =  \"#DFDEDF\";\n    if(index === initSelectedIndex || item.isCurrentNode) {\n        color = '#FF96AC';\n    }else if(item.ispassroute) {\n        color = '#0092FE';\n    }else if(item.isforecast) {\n        color = '#FFC285';\n    }\n    // else if(item.isforecast || \n    //     (researchedata && Object.keys(researchedata).length && Object.keys(researchedata).includes(item.act_id))) {\n    //     color = '#FFC285';\n    // }\n    return color;\n}\n\n/**\n * 节点信息生成\n * **/\nfunction flowFormatNode(originalData,international, researchedata){\n    console.log(\"researchedata\", researchedata)\n    const data = formatBeginEndDataSequence(originalData);\n    if(!data.length) {return []};\n    const initSelectedIndex = findInitSelectedIndex(data);\n    console.log(\"initSelectedIndex\", initSelectedIndex)\n    return data.map( (item, index) => {\n        let virtualName = item.act_name && item.act_name.length > 7 ? `${item.act_name.slice(0,7)}...` : item.act_name;\n        //设置当前选中的节点\n        let color = '#E0E0E0';\n        if(index === initSelectedIndex || item.isCurrentNode) {\n            color = '#FFBCCA';\n        }else if(item.ispassroute) {\n            color = '#A8D5FF';\n        }else if(item.isforecast || \n            (researchedata && Object.keys(researchedata).length && Object.keys(researchedata).includes(item.act_id))) {\n            color = '#FFD9B3';\n        }\n\n        return {\n            id: item.act_id ? item.act_id : item.startnode ? 'isstart' : `isend${index}`,\n            name: virtualName ? virtualName : item.startnode ? international['006'] : international['007'], // 006 开始  007 结束\n            x: item.dimension.split(';')[0],\n            y: item.dimension.split(';')[1],\n            color: color,\n            ispassroute: item.ispassroute,\n            style: {stroke: gerStrokeColor(item, index, initSelectedIndex)},\n            label: {//文本图形配置\n                text: virtualName ? virtualName : item.startnode ? international['006'] : international['007'],\n                fontSize: 13\n            },\n            tipName: item.act_name ? item.act_name : item.startnode ? international['006'] : international['007'],\n            billmaker: item.billmaker, // 008 无\n            actType: item.act_type_value || international['009'], // 009 暂无\n            merge_way: item.merge_way || international['009'], // 暂无\n            branch_way: item.branch_way || international['009'], // 暂无\n            ismain: item.ismain || false,\n            isstart: item.isstart || false,\n            index: index,//中间有环节被驳回时使用(后面是已通过环节)\n            racemodal: item.racemodal,\n            participantProcessModeValue: item.participantProcessModeValue,\n            participantProcessPassingThreshold: item.participantProcessPassingThreshold,\n            actortype: item.actortype,\n            actor: item.actor,\n            approveusers: item.approveusers || [],\n            transitionName: item.transitionName || \"\",\n            transitionDesc: item.transitionDesc || \"\",\n            isforecast: item.isforecast || false,\n            branch_way_value: item.branch_way_value || \"\",\n            merge_way_value: item.merge_way_value || \"\",\n            act_type: item.act_type || \"\",\n            committime: item.committime || \"\"\n            \n        }\n    })\n}\n/**\n * 一个流程节点包含多个来源\n * **/\nconst splitFromIdBySign = (fromId, sign=',') => {\n    //开始节点，无fromId属性，用自己配置的'isstart'\n    if(!fromId) {return 'isstart'}\n    if(!fromId.includes(sign)) {return fromId}\n    return fromId.split(sign);\n}\n\nconst gerEdgeColor = (item, obj) => {\n    console.log(\"obj\", obj.act_name, obj)\n    let color = \"#E0E0E0\";\n    if(item.ispassroute) {\n        color = \"#A8D5FF\";\n    }else if(item.isforecast && (obj.isforecast || obj.ispassroute)) {\n        color = \"#FFD9B3\";\n    }\n    return color;\n}\n\n/**\n * 流程节点关系数组生成\n * **/\nconst createEdges = (originalData) => {\n    const data = formatBeginEndDataSequence(originalData);\n    if(!data.length) {return []}\n    let edgesArr = [];\n    data.map( (item, index) => {\n        if(index > 0) {\n            //拆分后的真实fromId\n            const originalFromId = splitFromIdBySign(item.from_id);\n            if(originalFromId instanceof Array) {//同一节点有多个来源\n                originalFromId.map((childItem) => {\n                    const prevNode = data.find( (item) => {\n                        return item.act_id === childItem\n                    });\n                    edgesArr.push({\n                        source: childItem,//上一节点id\n                        target: item.act_id,//当前节点id \n                        id: `${childItem}-${item.act_id}`,\n                        color: gerEdgeColor(item, prevNode),\n                        label: item.transitionName,\n                        desc: item.transitionDesc\n                    })\n                })\n            }else {\n                let curIndex = -1,\n                    obj = null,\n                    virData = deepClone(data);\n                obj = virData.find( (list, index_0) => {\n                    if(item.from_id && item.isforecast && item.from_id.includes(list.act_id)) {\n                        curIndex = index_0;\n                        return true;\n                    }\n                })\n                obj = !!obj ? obj : {};\n                console.log(\"obj111\", obj.act_name, obj)\n                curIndex > -1 && virData.splice(curIndex, 1);\n                const fromId = item.from_id || 'isstart';//上一节点id\n                const actId = item.act_id || `isend${index}`;//当前节点id \n                edgesArr.push({\n                    source: fromId,//上一节点id\n                    target: actId,//当前节点id \n                    id: `${fromId}-${actId}`,\n                    color: gerEdgeColor(item, obj),\n                    label: item.transitionName,\n                    desc: item.transitionDesc\n                })\n            }\n        }\n    })\n    return edgesArr;\n}\n\n/**\n * 节点简单拖拽位置变化\n * **/\nconst dragNodeChangePostion = (graph) => {\n    let node;\n    let dx;\n    let dy;\n\n    graph.on('node:dragstart', ev=>{\n      const {item} = ev;\n      const model = item.getModel();\n      node = item;\n      dx = model.x - ev.x;\n      dy = model.y - ev.y;\n    });\n    graph.on('node:drag', ev=>{\n      node && graph.update(node, {\n        x: ev.x+dx,\n        y: ev.y+dy\n      });\n    });\n    graph.on('node:dragend', ev=>{\n      node = undefined;\n    });\n}\n\n/**\n * 生成初始化的当前所属节点\n * **/\nconst generateInitSelected = (originalData) => {\n    const data = formatBeginEndDataSequence(originalData);\n    const initSelectedIndex = findInitSelectedIndex(data);\n    if(!initSelectedIndex) {return ''}; \n    if(!data.length) {return ''};\n    const selectedId =  data.find( (item, index) => {\n        return initSelectedIndex.toString().includes(',') ? initSelectedIndex.toString().includes(index) : initSelectedIndex == index\n    }).act_id;\n\n    return selectedId\n}\n\n/**\n * 判断两个对象数组是否相等\n * **/\nconst equalArray = (arr1, arr2) => {\n    if(!arr2) return true;\n    if(Object.prototype.toString.call(arr1).slice(8, -1) !== 'Array' || Object.prototype.toString.call(arr2).slice(8, -1) !== 'Array') return false; \n    return JSON.stringify(arr1) === JSON.stringify(arr2)\n}\n\nexport {\n    flowFormatNode,\n    createEdges,\n    dragNodeChangePostion,\n    generateInitSelected,\n    equalArray\n}","const renderShape = (G6,shape) => {\n    if(shape === 'react') {\n        return G6.registerNode('rect', {\n            getPath: function getPath(item) {\n              var width = 100; // 一半宽\n              var height = 30; // 一半高\n              return G6.Util.getRectPath(-width / 2, -height / 2, width, height, 15);\n            }\n        });\n    }\n}\n\nexport {\n    renderShape,\n}\n"],"sourceRoot":""}